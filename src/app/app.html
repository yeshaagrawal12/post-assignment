<div class="app-container">
  <header class="header">
    <div class="header-content">
      <h1>Infinite Posts Feed</h1>
      <p class="subtitle">Scroll down to load more posts</p>
    </div>
  </header>

  <div class="search-container">
    <div class="search-wrapper">
      <input type="text" class="search-input" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange($event)"
        placeholder="Search posts by title or body" [disabled]="isLoading() && posts().length === 0" />
      @if (searchQuery) {
      <button class="clear-btn" (click)="clearSearch()" aria-label="Clear search">
        ‚úï
      </button>
      }
    </div>
    @if (filteredPosts().length > 0 || searchQuery) {
    <div class="results-info">
      @if (searchQuery) {
      <span>
        Found {{ filteredPosts().length }} result{{ filteredPosts().length !== 1 ? 's' : '' }}
      </span>
      } @else {
      <span>
        Showing {{ filteredPosts().length }} posts
      </span>
      }
    </div>
    }
  </div>

  <div class="content-area">
    <!-- Loading State (Initial) -->
    @if (isLoading() && posts().length === 0) {
    <div class="skeleton-container">
      @for (i of [1,2,3,4,5]; track i) {
      <div class="skeleton-card">
        <div class="skeleton-title"></div>
        <div class="skeleton-text"></div>
        <div class="skeleton-text short"></div>
      </div>
      }
    </div>
    }

    <!-- Error State -->
    @if (error() && posts().length === 0) {
    <div class="error-container">
      <div class="error-card">
        <span class="error-icon">‚ö†Ô∏è</span>
        <h3>Oops! Something went wrong</h3>
        <p>{{ error() }}</p>
        <button class="retry-btn" (click)="retryLoad()">
          Try Again
        </button>
      </div>
    </div>
    }

    <!-- Empty State -->
    @if (!isLoading() && filteredPosts().length === 0 && searchQuery && !error()) {
    <div class="empty-state">
      <span class="empty-icon">üîç</span>
      <h3>No posts found</h3>
      <p>Try adjusting your search terms</p>
      <button class="clear-search-btn" (click)="clearSearch()">
        Clear Search
      </button>
    </div>
    }

    <!-- Virtual Scroll List -->
    @if (filteredPosts().length > 0) {
    <cdk-virtual-scroll-viewport #viewport [itemSize]="180" class="viewport">
      <div class="posts-grid">
        @for (post of filteredPosts(); track $index) {
        <article class="post-card fade-in">
          <div class="post-header">
            <span class="post-id">#{{ post.id }}</span>
            <span class="user-badge">User {{ post.userId }}</span>
          </div>
          <h2 class="post-title">{{post.title}}</h2>
          <p class="post-body">{{ post.body }}</p>
        </article>
        }
      </div>

      <!-- Loading More Indicator -->
      @if (isLoadingMore()) {
      <div class="loading-more">
        <div class="spinner"></div>
        <span>Loading more posts...</span>
      </div>
      }

    </cdk-virtual-scroll-viewport>
    }
  </div>
</div>